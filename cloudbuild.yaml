steps:
# running docker-compose
- name: 'docker/compose:1.26.2'
  args: ['up', '-d']
# running docker-compose push to push service images to GCR
- name: 'docker/compose:1.26.2'
  args: ['push']

# deploy container images to GKE
- name: 'gcr.io/cloud-builders/kubectl'
  args: ['apply', '-f', 'frontend/frontend.yaml']
  env:
  - 'CLOUDSDK_COMPUTE_ZONE=us-central1-c'
  - 'CLOUDSDK_CONTAINER_CLUSTER=react-springboot-own-test-cluster'
- name: 'gcr.io/cloud-builders/kubectl'
  args: ['apply', '-f', 'backend/backend.yaml']
- name: 'gcr.io/cloud-builders/kubectl'
  args: ['apply', '-f', 'ingress-resource.yaml']

  # - name: 'gcr.io/cloud-builders/kubectl'
  #   args: ['create', '-f', 'frontend/frontend.yaml']
  # - name: 'gcr.io/cloud-builders/kubectl'
  #   args: ['create', '-f', 'backend/backend.yaml']

  # - name: "gcr.io/cloud-builders/gke-deploy"
  #   args:
  #   - run
  #   - --filename=frontend/frontend.yaml
  #   - --image=gcr.io/project-id/image:tag
  #   - --location=${_CLOUDSDK_COMPUTE_ZONE}
  #   - --cluster=${_CLOUDSDK_CONTAINER_CLUSTER}